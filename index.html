<!DOCTYPE html>
<html>
<head>
	<title>YouTube API Example</title>
	<script src="https://www.youtube.com/iframe_api"></script>
	<style>
		#player {
			width: 640px;
			height: 360px;
		}
	</style>
</head>
<body>
	<label for="url">YouTube URL:</label>
	<input type="text" id="url" name="url">
	<button onclick="loadVideo()">Load Video</button>
	<div id="player"></div>
	<select id="speed">
		<option value="0.1">10%</option>
		<option value="0.2">20%</option>
		<option value="0.3">30%</option>
		<option value="0.4">40%</option>
		<option value="0.5">50%</option>
		<option value="0.6">60%</option>
		<option value="0.7">70%</option>
		<option value="0.8">80%</option>
		<option value="0.9">90%</option>
		<option value="1" selected>100%</option>
		<option value="1.1">110%</option>
		<option value="1.2">120%</option>
		<option value="1.3">130%</option>
		<option value="1.4">140%</option>
		<option value="1.5">150%</option>
	</select>
	<div>
		Recent Videos:
		<ul id="recent-videos">
		</ul>
	</div>
	<script>
		var player;
		var recentVideos = [];
		function onYouTubeIframeAPIReady() {
			player = new YT.Player('player', {
				playerVars: {
					'controls': 1,
					'autoplay': 0,
					'enablejsapi': 1
				},
				events: {
					'onReady': onPlayerReady
				}
			});
		}
		function onPlayerReady(event) {
			document.getElementById('speed').addEventListener('change', function() {
				var speed = parseFloat(this.value);
				player.setPlaybackRate(speed);
			});
			document.addEventListener('keydown', function(event) {
				if (event.keyCode == 32) {
					event.preventDefault();
					if (player.getPlayerState() == YT.PlayerState.PLAYING) {
						player.pauseVideo();
					} else {
						player.playVideo();
					}
				}
			});
			loadRecentVideos();
			loadLastVideo();
		}
		function loadVideo() {
			var url = document.getElementById('url').value;
			var videoId = getVideoIdFromUrl(url);
			if (videoId) {
				player.loadVideoById(videoId);
				addRecentVideo(url, videoId);
				saveRecentVideos();
			} else {
				alert('Invalid YouTube URL');
			}
		}
		function loadLastVideo() {
			var lastUrl = localStorage.getItem('lastUrl');
			if (lastUrl) {
				document.getElementById('url').value = lastUrl;
				loadVideo();
			}
		}
		function addRecentVideo(url, videoId) {
			recentVideos.unshift({url: url, videoId: videoId});
			if (recentVideos.length > 5) {
				recentVideos.pop();
			}
			updateRecentVideos();
		}
		function updateRecentVideos() {
			var list = document.getElementById('recent-videos');
			list.innerHTML = '';
			for (var i = 0; i < recentVideos.length; i++) {
				var item = document.createElement('li');
				var link = document.createElement('a');
				link.href = '#';
				link.textContent = recentVideos[i].url;
				link.addEventListener('click', createLoadVideoHandler(recentVideos[i].url));
				item.appendChild(link);
				list.appendChild(item);
			}
		}
		function createLoadVideoHandler(url) {
			return function(event) {
				event.preventDefault();
				document.getElementById('url').value = url;
				loadVideo();
			}
		}
		function loadRecentVideos() {
			var recentVideosJson = localStorage.getItem('recentVideos');
			if (recentVideosJson) {
				recentVideos = JSON.parse(recentVideosJson);
				updateRecentVideos();
			}
		}
		function saveRecentVideos() {
			localStorage.setItem('recentVideos', JSON.stringify(recentVideos));
			localStorage.setItem('lastUrl', recentVideos[0].url);
		}
		function getVideoIdFromUrl(url) {
			var match = url.match(/[?&]v=([^&]+)/);
			if (match) {
				return match[1];
			} else {
				return null;
			}
		}
	</script>
</body>
</html>
